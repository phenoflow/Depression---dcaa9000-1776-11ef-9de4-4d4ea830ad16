# Kuan V, Denaxas S, Gonzalez-Izquierdo A, Direk K, Bhatti O, Husain S, Sutaria S, Hingorani M, Nitsch D, Parisinos C, Lumbers T, Mathur R, Sofat R, Casas JP, Wong I, Hemingway H, Hingorani A, 2024.

import sys, csv, re

codes = [{"code":"Eu20400","system":"readv2"},{"code":"Eu33z11","system":"readv2"},{"code":"Eu32400","system":"readv2"},{"code":"Eu34112","system":"readv2"},{"code":"9HA0.00","system":"readv2"},{"code":"Eu32z11","system":"readv2"},{"code":"1465.00","system":"readv2"},{"code":"E2B..00","system":"readv2"},{"code":"212S.00","system":"readv2"},{"code":"Eu34113","system":"readv2"},{"code":"8HHq.00","system":"readv2"},{"code":"Eu34111","system":"readv2"},{"code":"Eu32z12","system":"readv2"},{"code":"E2B1.00","system":"readv2"},{"code":"28863.0","system":"readv2"},{"code":"14709.0","system":"readv2"},{"code":"15155.0","system":"readv2"},{"code":"9211.0","system":"readv2"},{"code":"1055.0","system":"readv2"},{"code":"7604.0","system":"readv2"},{"code":"4639.0","system":"readv2"},{"code":"9667.0","system":"readv2"},{"code":"9055.0","system":"readv2"},{"code":"2560.0","system":"readv2"},{"code":"2970.0","system":"readv2"},{"code":"324.0","system":"readv2"},{"code":"73991.0","system":"readv2"},{"code":"6546.0","system":"readv2"},{"code":"29451.0","system":"readv2"},{"code":"10290.0","system":"readv2"},{"code":"98252.0","system":"readv2"},{"code":"32941.0","system":"readv2"},{"code":"21887.0","system":"readv2"},{"code":"16632.0","system":"readv2"},{"code":"8584.0","system":"readv2"},{"code":"7749.0","system":"readv2"},{"code":"11717.0","system":"readv2"},{"code":"23731.0","system":"readv2"},{"code":"35274.0","system":"readv2"},{"code":"10825.0","system":"readv2"},{"code":"25697.0","system":"readv2"},{"code":"10610.0","system":"readv2"},{"code":"29520.0","system":"readv2"},{"code":"8851.0","system":"readv2"},{"code":"3292.0","system":"readv2"},{"code":"18510.0","system":"readv2"},{"code":"3291.0","system":"readv2"},{"code":"37764.0","system":"readv2"},{"code":"41989.0","system":"readv2"},{"code":"31757.0","system":"readv2"},{"code":"47009.0","system":"readv2"},{"code":"9183.0","system":"readv2"},{"code":"6932.0","system":"readv2"},{"code":"25563.0","system":"readv2"},{"code":"56609.0","system":"readv2"},{"code":"29342.0","system":"readv2"},{"code":"15220.0","system":"readv2"},{"code":"29784.0","system":"readv2"},{"code":"28248.0","system":"readv2"},{"code":"655.0","system":"readv2"},{"code":"24171.0","system":"readv2"},{"code":"6854.0","system":"readv2"},{"code":"11913.0","system":"readv2"},{"code":"98346.0","system":"readv2"},{"code":"19696.0","system":"readv2"},{"code":"4323.0","system":"readv2"},{"code":"16506.0","system":"readv2"},{"code":"43324.0","system":"readv2"},{"code":"41022.0","system":"readv2"},{"code":"8478.0","system":"readv2"},{"code":"28677.0","system":"readv2"},{"code":"11252.0","system":"readv2"},{"code":"33469.0","system":"readv2"},{"code":"6950.0","system":"readv2"},{"code":"24112.0","system":"readv2"},{"code":"98414.0","system":"readv2"},{"code":"10667.0","system":"readv2"},{"code":"5987.0","system":"readv2"},{"code":"35671.0","system":"readv2"},{"code":"15099.0","system":"readv2"},{"code":"59386.0","system":"readv2"},{"code":"595.0","system":"readv2"},{"code":"52678.0","system":"readv2"},{"code":"11055.0","system":"readv2"},{"code":"17770.0","system":"readv2"},{"code":"6482.0","system":"readv2"},{"code":"20785.0","system":"readv2"},{"code":"7953.0","system":"readv2"},{"code":"543.0","system":"readv2"},{"code":"7011.0","system":"readv2"},{"code":"47731.0","system":"readv2"},{"code":"44300.0","system":"readv2"},{"code":"27491.0","system":"readv2"},{"code":"28756.0","system":"readv2"},{"code":"24117.0","system":"readv2"},{"code":"5879.0","system":"readv2"},{"code":"16861.0","system":"readv2"},{"code":"34390.0","system":"readv2"},{"code":"32159.0","system":"readv2"},{"code":"56273.0","system":"readv2"},{"code":"15219.0","system":"readv2"},{"code":"10720.0","system":"readv2"},{"code":"8826.0","system":"readv2"},{"code":"7737.0","system":"readv2"},{"code":"36616.0","system":"readv2"},{"code":"98417.0","system":"readv2"},{"code":"27677.0","system":"readv2"},{"code":"22806.0","system":"readv2"},{"code":"11329.0","system":"readv2"},{"code":"43292.0","system":"readv2"},{"code":"8902.0","system":"readv2"},{"code":"12099.0","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('depression-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["depression---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["depression---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["depression---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
